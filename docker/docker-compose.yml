version: '3.9'

services:
  api:
    build:
      context: ..
      dockerfile: docker/api.Dockerfile
    env_file:
      - ../apps/api/.env.example
    environment:
      PORT: 3001
      MONGODB_URI: mongodb://mongo:27017/mentor-app
      MONGODB_DB_NAME: mentor-app
      JWT_SECRET: ${JWT_SECRET:-change_me}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}
      ALLOWED_ORIGINS: ${ALLOWED_ORIGINS:-http://localhost:3000}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY:-}
      GROQ_API_KEY: ${GROQ_API_KEY:-}
      LLM_PROVIDER: ${LLM_PROVIDER:-openrouter}
      QDRANT_URL: ${QDRANT_URL:-http://qdrant:6333}
    ports:
      - '3001:3001'
    depends_on:
      - mongo
      - qdrant

  web:
    build:
      context: ..
      dockerfile: docker/web.Dockerfile
    env_file:
      - ../apps/web/.env.example
    environment:
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://api:3001}
    ports:
      - '3000:3000'
    depends_on:
      - api

  mongo:
    image: mongo:6
    restart: unless-stopped
    environment:
      MONGO_INITDB_DATABASE: mentor-app
    volumes:
      - mongo_data:/data/db
    ports:
      - '27017:27017'

  qdrant:
    image: qdrant/qdrant:latest
    restart: unless-stopped
    ports:
      - '6333:6333'
      - '6334:6334'
    volumes:
      - qdrant_data:/qdrant/storage

volumes:
  mongo_data:
  qdrant_data:
